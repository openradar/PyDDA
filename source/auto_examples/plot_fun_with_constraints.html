
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Example on geographic plotting and constraint variation &#8212; PyDDA 1.4.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Developer Reference Manual" href="../../dev_reference/index.html" />
    <link rel="prev" title="Example of a wind retrieval in a tornado over Sydney" href="plot_sydney_tornado.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../index.html">
<p class="title">PyDDA</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../contributors_guide/index.html">
  Contributorâ€™s Guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  PyDDA Example Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../dev_reference/index.html">
  Developer Reference Manual
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="hurricane_florence.html">
   Example on integrating radar and HRRR data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot_examples.html">
   Example on retrieving and plotting winds
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot_sydney_tornado.html">
   Example of a wind retrieval in a tornado over Sydney
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Example on geographic plotting and constraint variation
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-source-auto-examples-plot-fun-with-constraints-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="example-on-geographic-plotting-and-constraint-variation">
<span id="sphx-glr-source-auto-examples-plot-fun-with-constraints-py"></span><h1>Example on geographic plotting and constraint variation<a class="headerlink" href="#example-on-geographic-plotting-and-constraint-variation" title="Permalink to this headline">#</a></h1>
<p>In this example we show how to plot wind fields on a map and change
the default constraint coefficients using PyDDA.</p>
<p>This shows how important it is to have the proper intitial state and
constraints when you derive your wind fields. In the first figure,
the sounding was used as the initial state, but for the latter
two examples we use a zero initial state which provides for more
questionable winds at the edges of the Dual Doppler Lobes.</p>
<p>This shows that your initial state and background are key to
providing a physically realistic retrieval. Assuming a zero
background will likely result in false regions of convergence
and divergence that will generate artificial updrafts and downdrafts
at the edges of data coverage.</p>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_001.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_001.png" alt="PyDDA retreived winds @10.0 km south of origin." class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_002.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_002.png" alt="PyDDA retreived winds @10.0 km south of origin." class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_003.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_003.png" alt="PyDDA retreived winds @10.0 km south of origin." class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/usr/share/miniconda3/envs/pydda-docs/lib/python3.11/site-packages/pyart/io/cfradial.py:408: UserWarning: WARNING: valid_min not used since it
cannot be safely cast to variable data type
  data = self.ncvar[:]
/usr/share/miniconda3/envs/pydda-docs/lib/python3.11/site-packages/pyart/io/cfradial.py:408: UserWarning: WARNING: valid_max not used since it
cannot be safely cast to variable data type
  data = self.ncvar[:]
Interpolating sounding to radar grid
Interpolated U field:
tf.Tensor(
[  0.60573435   1.0229144    6.434673    11.977132    12.919597
   9.719978    14.212554    17.673002     9.373551     4.932108
   7.0470777    4.581866     3.8447456    1.9784147   -2.7835784
  -4.8090096   -8.388001    -8.310871    -6.199968    -8.8743305
  -7.5828705   -6.553336    -7.493186    -8.902025   -11.6616335
 -13.175965   -15.263804   -16.580751   -17.48236    -23.17236
 -20.712376   -18.823587   -16.356308   -25.138748   -29.280111
 -28.940443   -19.437548   -10.714591    -9.689518  ], shape=(39,), dtype=float32)
Interpolated V field:
tf.Tensor(
[-6.9235525  -6.326603   -6.434671   -6.9149985  -6.5828586  -3.927123
 -6.6274214  -8.241055   -9.051932   -3.2364333   0.8652741  -1.430016
  0.54577833 -1.4374017  -0.30149823  3.5418017   4.45998     5.19321
  5.667021    7.446448   10.062807   10.487528   11.109102   10.993081
  9.54446    11.055948    9.912431   11.183857    9.295537    2.4355142
 -0.723292   -1.9784379   1.1915643   5.803736    3.5951443  -2.0237138
  2.7317686   6.437976    2.7784247 ], shape=(39,), dtype=float32)
Grid levels:
[ 1000.  1500.  2000.  2500.  3000.  3500.  4000.  4500.  5000.  5500.
  6000.  6500.  7000.  7500.  8000.  8500.  9000.  9500. 10000. 10500.
 11000. 11500. 12000. 12500. 13000. 13500. 14000. 14500. 15000. 15500.
 16000. 16500. 17000. 17500. 18000. 18500. 19000. 19500. 20000.]
/home/runner/work/PyDDA/PyDDA/pydda/retrieval/angles.py:24: RuntimeWarning: invalid value encountered in arccos
  elev = np.arccos((Re**2 + slantrsq - rh**2) / (2 * Re * slantr))
Calculating weights for radars 0 and 1
Calculating weights for radars 1 and 0
Calculating weights for models...
Points from Radar 0: 40597
Points from Radar 1: 40597
Starting solver
rmsVR = 6.827304
Total points: 81194
The max of w_init is 0.0
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
      0|55964.2227|   0.0000|   0.0091|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000
The gradient of the cost functions is 28.290936
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     10| 433.0938|   7.0422|   0.0092|   3.0986|   0.0000|   0.0000|   0.0000|  14.7014
The gradient of the cost functions is 0.93045557
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     20|   7.5543|   8.1688|   0.0093|   3.1913|   0.0000|   0.0000|   0.0000|  14.4342
The gradient of the cost functions is 0.09527958
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     30|   4.1321|   8.0791|   0.0093|   3.1982|   0.0000|   0.0000|   0.0000|  14.4571
The gradient of the cost functions is 0.1433602
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     40|   0.0596|   8.0676|   0.0093|   3.2001|   0.0000|   0.0000|   0.0000|  14.5702
The gradient of the cost functions is 0.082182944
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     50|   0.1758|   7.5954|   0.0093|   3.2102|   0.0000|   0.0000|   0.0000|  14.6147
The gradient of the cost functions is 0.098248966
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     60|   3.0544|   4.3691|   0.0093|   4.1731|   0.0000|   0.0000|   0.0000|  18.6557
The gradient of the cost functions is 0.19085652
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     70|   0.2120|   4.6897|   0.0093|   3.8213|   0.0000|   0.0000|   0.0000|  17.6196
The gradient of the cost functions is 0.037094783
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     80|   0.1678|   4.5853|   0.0093|   3.8627|   0.0000|   0.0000|   0.0000|  17.8189
The gradient of the cost functions is 0.0451551
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     90|   0.5275|   3.9846|   0.0093|   4.1231|   0.0000|   0.0000|   0.0000|  19.5749
The gradient of the cost functions is 0.116284646
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    100|   0.0519|   4.0239|   0.0093|   4.0928|   0.0000|   0.0000|   0.0000|  19.4148
The gradient of the cost functions is 0.019677764
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    110|   0.0498|   3.9728|   0.0093|   4.1092|   0.0000|   0.0000|   0.0000|  19.6031
The gradient of the cost functions is 0.040121827
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    120|   0.2664|   3.5551|   0.0093|   4.2000|   0.0000|   0.0000|   0.0000|  21.3789
The gradient of the cost functions is 0.21858713
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    130|   0.0598|   3.2439|   0.0094|   4.3475|   0.0000|   0.0000|   0.0000|  23.3502
The gradient of the cost functions is 0.0137825
Applying low pass filter to wind field...
Done! Time = 220.3
Interpolating sounding to radar grid
Interpolated U field:
tf.Tensor(
[  0.60573435   1.0229144    6.434673    11.977132    12.919597
   9.719978    14.212554    17.673002     9.373551     4.932108
   7.0470777    4.581866     3.8447456    1.9784147   -2.7835784
  -4.8090096   -8.388001    -8.310871    -6.199968    -8.8743305
  -7.5828705   -6.553336    -7.493186    -8.902025   -11.6616335
 -13.175965   -15.263804   -16.580751   -17.48236    -23.17236
 -20.712376   -18.823587   -16.356308   -25.138748   -29.280111
 -28.940443   -19.437548   -10.714591    -9.689518  ], shape=(39,), dtype=float32)
Interpolated V field:
tf.Tensor(
[-6.9235525  -6.326603   -6.434671   -6.9149985  -6.5828586  -3.927123
 -6.6274214  -8.241055   -9.051932   -3.2364333   0.8652741  -1.430016
  0.54577833 -1.4374017  -0.30149823  3.5418017   4.45998     5.19321
  5.667021    7.446448   10.062807   10.487528   11.109102   10.993081
  9.54446    11.055948    9.912431   11.183857    9.295537    2.4355142
 -0.723292   -1.9784379   1.1915643   5.803736    3.5951443  -2.0237138
  2.7317686   6.437976    2.7784247 ], shape=(39,), dtype=float32)
Grid levels:
[ 1000.  1500.  2000.  2500.  3000.  3500.  4000.  4500.  5000.  5500.
  6000.  6500.  7000.  7500.  8000.  8500.  9000.  9500. 10000. 10500.
 11000. 11500. 12000. 12500. 13000. 13500. 14000. 14500. 15000. 15500.
 16000. 16500. 17000. 17500. 18000. 18500. 19000. 19500. 20000.]
/home/runner/work/PyDDA/PyDDA/pydda/retrieval/angles.py:24: RuntimeWarning: invalid value encountered in arccos
  elev = np.arccos((Re**2 + slantrsq - rh**2) / (2 * Re * slantr))
Calculating weights for radars 0 and 1
Calculating weights for radars 1 and 0
Calculating weights for models...
Points from Radar 0: 40597
Points from Radar 1: 40597
Starting solver
rmsVR = 6.827304
Total points: 81194
The max of w_init is 0.0
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
      0|83859.8125|   0.0000|   0.0000|1274.4282|   0.0000|   0.0000|   0.0000|   0.0000
The gradient of the cost functions is 31.80345
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     10| 704.4634|   7.6629|   0.0003|1271.5490|   0.0000|   0.0000|   0.0000|  11.8140
The gradient of the cost functions is 1.190283
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     20|  11.1175|   8.6839|   0.0003|1262.6156|   0.0000|   0.0000|   0.0000|  11.5597
The gradient of the cost functions is 0.330789
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     30|  19.4754|   8.5079|   0.0003|1241.5200|   0.0000|   0.0000|   0.0000|  11.3770
The gradient of the cost functions is 2.2754292
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     40|  62.3501|   7.4340|   0.0004|1120.5829|   0.0000|   0.0000|   0.0000|  11.9248
The gradient of the cost functions is 3.5188248
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     50| 175.4700|  13.4436|   0.0051| 111.8275|   0.0000|   0.0000|   0.0000|  15.0880
The gradient of the cost functions is 0.58877474
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     60| 169.9729|  27.4714|   0.0096|  11.7312|   0.0000|   0.0000|   0.0000|  19.1073
The gradient of the cost functions is 0.91222954
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     70|   6.8313|  24.8837|   0.0089|  12.7703|   0.0000|   0.0000|   0.0000|  17.9690
The gradient of the cost functions is 0.2905506
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     80|   5.0923|  22.3917|   0.0090|  11.5872|   0.0000|   0.0000|   0.0000|  17.5588
The gradient of the cost functions is 0.25399297
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     90|  21.6780|  11.7222|   0.0092|   7.3413|   0.0000|   0.0000|   0.0000|  16.4682
The gradient of the cost functions is 0.6049808
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    100|   2.0664|  12.5581|   0.0092|   7.6458|   0.0000|   0.0000|   0.0000|  16.4887
The gradient of the cost functions is 0.14174253
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    110|   2.1252|  11.3306|   0.0092|   7.2155|   0.0000|   0.0000|   0.0000|  16.4568
The gradient of the cost functions is 0.21625641
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    120|   8.8208|   5.2879|   0.0093|   4.9891|   0.0000|   0.0000|   0.0000|  16.2498
The gradient of the cost functions is 0.70314753
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    130|   0.5751|   5.0909|   0.0093|   4.8852|   0.0000|   0.0000|   0.0000|  16.2025
The gradient of the cost functions is 0.048374817
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    140|   0.0371|   5.0346|   0.0093|   4.8496|   0.0000|   0.0000|   0.0000|  16.1679
The gradient of the cost functions is 0.026955975
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    150|   0.1442|   4.9044|   0.0093|   4.8104|   0.0000|   0.0000|   0.0000|  16.1535
The gradient of the cost functions is 0.19354095
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    160|   0.3021|   4.4439|   0.0093|   4.6783|   0.0000|   0.0000|   0.0000|  16.1147
The gradient of the cost functions is 0.083998986
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    170|   0.0857|   3.7469|   0.0094|   4.5192|   0.0000|   0.0000|   0.0000|  17.1091
Applying low pass filter to wind field...
Done! Time = 285.0
Interpolating sounding to radar grid
Interpolated U field:
tf.Tensor(
[  0.60573435   1.0229144    6.434673    11.977132    12.919597
   9.719978    14.212554    17.673002     9.373551     4.932108
   7.0470777    4.581866     3.8447456    1.9784147   -2.7835784
  -4.8090096   -8.388001    -8.310871    -6.199968    -8.8743305
  -7.5828705   -6.553336    -7.493186    -8.902025   -11.6616335
 -13.175965   -15.263804   -16.580751   -17.48236    -23.17236
 -20.712376   -18.823587   -16.356308   -25.138748   -29.280111
 -28.940443   -19.437548   -10.714591    -9.689518  ], shape=(39,), dtype=float32)
Interpolated V field:
tf.Tensor(
[-6.9235525  -6.326603   -6.434671   -6.9149985  -6.5828586  -3.927123
 -6.6274214  -8.241055   -9.051932   -3.2364333   0.8652741  -1.430016
  0.54577833 -1.4374017  -0.30149823  3.5418017   4.45998     5.19321
  5.667021    7.446448   10.062807   10.487528   11.109102   10.993081
  9.54446    11.055948    9.912431   11.183857    9.295537    2.4355142
 -0.723292   -1.9784379   1.1915643   5.803736    3.5951443  -2.0237138
  2.7317686   6.437976    2.7784247 ], shape=(39,), dtype=float32)
Grid levels:
[ 1000.  1500.  2000.  2500.  3000.  3500.  4000.  4500.  5000.  5500.
  6000.  6500.  7000.  7500.  8000.  8500.  9000.  9500. 10000. 10500.
 11000. 11500. 12000. 12500. 13000. 13500. 14000. 14500. 15000. 15500.
 16000. 16500. 17000. 17500. 18000. 18500. 19000. 19500. 20000.]
/home/runner/work/PyDDA/PyDDA/pydda/retrieval/angles.py:24: RuntimeWarning: invalid value encountered in arccos
  elev = np.arccos((Re**2 + slantrsq - rh**2) / (2 * Re * slantr))
Calculating weights for radars 0 and 1
Calculating weights for radars 1 and 0
Calculating weights for models...
Points from Radar 0: 40597
Points from Radar 1: 40597
Starting solver
rmsVR = 6.827304
Total points: 81194
The max of w_init is 0.0
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
      0|559642.2500|   0.0000|   0.0091|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000
The gradient of the cost functions is 43.086624
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     10|1749.9241|   7.5786|   0.0093|   3.1306|   0.0000|   0.0000|   0.0000|  14.5110
The gradient of the cost functions is 4.6896725
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     20|1137.4941|   8.5454|   0.0093|   3.2925|   0.0000|   0.0000|   0.0000|  14.2475
The gradient of the cost functions is 6.302576
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     30|   2.9904|   8.2880|   0.0093|   3.2073|   0.0000|   0.0000|   0.0000|  14.5463
The gradient of the cost functions is 0.22074592
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     40|   0.2788|   8.2843|   0.0093|   3.2055|   0.0000|   0.0000|   0.0000|  14.5582
The gradient of the cost functions is 0.060598515
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     50|   0.2472|   8.2683|   0.0093|   3.2056|   0.0000|   0.0000|   0.0000|  14.5609
The gradient of the cost functions is 0.38104638
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     60|   0.1309|   8.2121|   0.0093|   3.2062|   0.0000|   0.0000|   0.0000|  14.5681
The gradient of the cost functions is 0.09837987
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     70|   0.0240|   8.1106|   0.0093|   3.2093|   0.0000|   0.0000|   0.0000|  14.5778
Applying low pass filter to wind field...
Done! Time = 126.1
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pydda</span>
<span class="kn">import</span> <span class="nn">pyart</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="n">berr_grid</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_grid</span><span class="p">(</span><span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">EXAMPLE_RADAR0</span><span class="p">)</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_grid</span><span class="p">(</span><span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">EXAMPLE_RADAR1</span><span class="p">)</span>

<span class="c1"># Load our radar data</span>
<span class="n">sounding</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_arm_sonde</span><span class="p">(</span><span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">SOUNDING_PATH</span><span class="p">)</span>
<span class="n">berr_grid</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_constant_wind_field</span><span class="p">(</span><span class="n">berr_grid</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

<span class="c1"># Let&#39;s provide an initial state from the sounding</span>
<span class="n">u_back</span> <span class="o">=</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">u_wind</span>
<span class="n">v_back</span> <span class="o">=</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v_wind</span>
<span class="n">z_back</span> <span class="o">=</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">height</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_wind_field_from_profile</span><span class="p">(</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">new_grids</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">get_dd_wind_field</span><span class="p">(</span>
    <span class="p">[</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span>
    <span class="n">u_back</span><span class="o">=</span><span class="n">u_back</span><span class="p">,</span>
    <span class="n">v_back</span><span class="o">=</span><span class="n">v_back</span><span class="p">,</span>
    <span class="n">z_back</span><span class="o">=</span><span class="n">z_back</span><span class="p">,</span>
    <span class="n">Co</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">Cm</span><span class="o">=</span><span class="mf">64.0</span><span class="p">,</span>
    <span class="n">frz</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
    <span class="n">Cb</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
    <span class="n">Cx</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cy</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cz</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">mask_outside_opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">wind_tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_xz_xsection_streamlines</span><span class="p">(</span>
    <span class="n">new_grids</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Let&#39;s see what happens when we use a zero initialization</span>
<span class="c1"># This causes there to be convergence in the cone of silence</span>
<span class="c1"># This is an artifact that we want to avoid!</span>
<span class="c1"># Prescribing winds inside the background through either a constraint</span>
<span class="c1"># Or through the initial state will help mitigate this issue.</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_constant_wind_field</span><span class="p">(</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="n">new_grids</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">get_dd_wind_field</span><span class="p">(</span>
    <span class="p">[</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span>
    <span class="n">u_back</span><span class="o">=</span><span class="n">u_back</span><span class="p">,</span>
    <span class="n">v_back</span><span class="o">=</span><span class="n">v_back</span><span class="p">,</span>
    <span class="n">z_back</span><span class="o">=</span><span class="n">z_back</span><span class="p">,</span>
    <span class="n">Co</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">Cm</span><span class="o">=</span><span class="mf">64.0</span><span class="p">,</span>
    <span class="n">frz</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
    <span class="n">Cb</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
    <span class="n">Cx</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cy</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cz</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">mask_outside_opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">wind_tol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_xz_xsection_streamlines</span><span class="p">(</span>
    <span class="n">new_grids</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Or, let&#39;s make the radar data more important!</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_wind_field_from_profile</span><span class="p">(</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">new_grids</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">get_dd_wind_field</span><span class="p">(</span>
    <span class="p">[</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span>
    <span class="n">Co</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">Cm</span><span class="o">=</span><span class="mf">64.0</span><span class="p">,</span>
    <span class="n">frz</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
    <span class="n">u_back</span><span class="o">=</span><span class="n">u_back</span><span class="p">,</span>
    <span class="n">v_back</span><span class="o">=</span><span class="n">v_back</span><span class="p">,</span>
    <span class="n">z_back</span><span class="o">=</span><span class="n">z_back</span><span class="p">,</span>
    <span class="n">Cb</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
    <span class="n">Cx</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cy</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cz</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">mask_outside_opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">wind_tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_xz_xsection_streamlines</span><span class="p">(</span>
    <span class="n">new_grids</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (10 minutes 34.963 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-source-auto-examples-plot-fun-with-constraints-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/564db4ff92b5949f5865201b6023e7a2/plot_fun_with_constraints.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_fun_with_constraints.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/69088b28623951c8bc5bf24f02f5316d/plot_fun_with_constraints.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_fun_with_constraints.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="plot_sydney_tornado.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Example of a wind retrieval in a tornado over Sydney</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../dev_reference/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Developer Reference Manual</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2023, PyDDA Developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>