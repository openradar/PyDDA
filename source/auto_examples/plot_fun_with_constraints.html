
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Example on geographic plotting and constraint variation &#8212; PyDDA 1.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example on retrieving and plotting winds" href="plot_examples.html" />
    <link rel="prev" title="Example of a wind retrieval from KVNX and 2 XSAPRs in Oklahoma" href="oklahoma_example.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="plot_examples.html" title="Example on retrieving and plotting winds"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="oklahoma_example.html" title="Example of a wind retrieval from KVNX and 2 XSAPRs in Oklahoma"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">PyDDA 1.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">PyDDA Example Gallery</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Example on geographic plotting and constraint variation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-source-auto-examples-plot-fun-with-constraints-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="example-on-geographic-plotting-and-constraint-variation">
<span id="sphx-glr-source-auto-examples-plot-fun-with-constraints-py"></span><h1>Example on geographic plotting and constraint variation<a class="headerlink" href="#example-on-geographic-plotting-and-constraint-variation" title="Permalink to this heading">Â¶</a></h1>
<p>In this example we show how to plot wind fields on a map and change
the default constraint coefficients using PyDDA.</p>
<p>This shows how important it is to have the proper intitial state and
constraints when you derive your wind fields. In the first figure,
the sounding was used as the initial state, but for the latter
two examples we use a zero initial state which provides for more
questionable winds at the edges of the Dual Doppler Lobes.</p>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_001.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_001.png" alt="PyDDA retreived winds @4.54 km" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_002.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_002.png" alt="PyDDA retreived winds @4.54 km" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_003.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_003.png" alt="PyDDA retreived winds @4.54 km" class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/pyart/io/cfradial.py:376: UserWarning: WARNING: valid_min not used since it
cannot be safely cast to variable data type
  data = self.ncvar[:]
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/pyart/io/cfradial.py:376: UserWarning: WARNING: valid_max not used since it
cannot be safely cast to variable data type
  data = self.ncvar[:]
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1662: UserWarning: linewidths is ignored by contourf
  result = super().contourf(*args, **kwargs)
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1614: UserWarning: The following kwargs were not used by contour: &#39;color&#39;
  result = super().contour(*args, **kwargs)
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1614: UserWarning: The following kwargs were not used by contour: &#39;color&#39;
  result = super().contour(*args, **kwargs)
/home/runner/work/PyDDA/PyDDA/pydda/retrieval/angles.py:24: RuntimeWarning: invalid value encountered in arccos
  elev = np.arccos((Re**2 + slantrsq - rh**2)/(2 * Re * slantr))
Calculating weights for radars 0 and 1
Calculating weights for models...
Starting solver
rmsVR = 6.7765408
Total points: 92100
The max of w_init is 0.0
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/tensorflow_probability/python/__init__.py:57: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  if (distutils.version.LooseVersion(tf.__version__) &lt;
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/tensorflow_probability/python/__init__.py:58: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
  distutils.version.LooseVersion(required_tensorflow_version)):
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
      0|94406.4375|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000
The gradient of the cost functions is 30.776155
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     10| 792.6587|  27.0629|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.4189
The gradient of the cost functions is 1.1458552
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     20|  11.9915|  27.5590|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.3768
The gradient of the cost functions is 0.16042161
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     30|   8.6511|  24.9324|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.2213
The gradient of the cost functions is 0.4771724
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     40|   1.3918|  22.3669|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.2279
The gradient of the cost functions is 0.29498246
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     50|   1.0119|  13.2022|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.5467
The gradient of the cost functions is 0.07316962
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     60|   1.4775|  12.0977|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  12.8451
The gradient of the cost functions is 0.32597876
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     70|   0.7970|  10.4695|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  13.4474
The gradient of the cost functions is 0.14800872
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     80|   0.2632|   7.7988|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  15.5507
The gradient of the cost functions is 0.052941103
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     90|   0.5726|   7.2286|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  16.3683
The gradient of the cost functions is 0.29541352
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    100|   0.4691|   6.2155|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  17.1831
The gradient of the cost functions is 0.09950946
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    110|   0.1378|   5.1916|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  18.8398
The gradient of the cost functions is 0.039999932
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    120|   0.3247|   4.8510|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  19.4606
The gradient of the cost functions is 0.21990514
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    130|   0.2561|   4.3347|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  19.9515
The gradient of the cost functions is 0.076022156
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    140|   0.0774|   3.7146|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  21.0764
The gradient of the cost functions is 0.033464972
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    150|   0.2037|   3.4826|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  21.3898
The gradient of the cost functions is 0.19237712
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    160|   0.1705|   3.1348|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  21.5362
The gradient of the cost functions is 0.061364368
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    170|   0.0528|   2.7625|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  21.8001
The gradient of the cost functions is 0.02592373
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    180|   0.1334|   2.6163|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  22.1033
The gradient of the cost functions is 0.15037319
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    190|   0.1231|   2.3543|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  23.0739
The gradient of the cost functions is 0.042865142
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    200|   0.0209|   2.1243|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  24.9178
The gradient of the cost functions is 0.022783943
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    210|   0.0856|   2.0139|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  25.5361
The gradient of the cost functions is 0.16609997
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    220|   0.0842|   1.7763|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  26.7545
The gradient of the cost functions is 0.026297385
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    230|   0.0093|   1.6984|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  27.7018
The gradient of the cost functions is 0.025802936
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    240|   0.1035|   1.5561|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  28.2987
The gradient of the cost functions is 0.15996143
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    250|   0.0358|   1.4296|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  29.1080
The gradient of the cost functions is 0.02004459
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    260|   0.0070|   1.3981|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  29.4189
The gradient of the cost functions is 0.02916602
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    270|   0.1365|   1.2257|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  30.0542
The gradient of the cost functions is 0.11317099
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    280|   0.0134|   1.1967|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  30.2898
The gradient of the cost functions is 0.020001035
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    290|   0.0094|   1.1672|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  30.3941
The gradient of the cost functions is 0.026978092
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    300|   0.1529|   1.0299|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  31.3112
The gradient of the cost functions is 0.0673162
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    310|   0.0064|   1.0191|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  31.1192
The gradient of the cost functions is 0.024613187
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    320|   0.0145|   0.9754|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  31.5183
The gradient of the cost functions is 0.01894762
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    330|   0.1138|   0.8911|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  33.2778
The gradient of the cost functions is 0.04204874
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    340|   0.0052|   0.8774|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  32.9678
The gradient of the cost functions is 0.029980619
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    350|   0.0186|   0.8122|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  33.5073
The gradient of the cost functions is 0.01179132
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    360|   0.0481|   0.7714|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  34.3528
The gradient of the cost functions is 0.03361709
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    370|   0.0070|   0.7603|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  34.3032
The gradient of the cost functions is 0.028040366
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    380|   0.0130|   0.6953|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  34.8399
The gradient of the cost functions is 0.008324462
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    390|   0.0199|   0.6796|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  35.1329
The gradient of the cost functions is 0.037039127
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    400|   0.0110|   0.6607|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  35.1941
The gradient of the cost functions is 0.019848885
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    410|   0.0059|   0.6170|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  35.5223
LBfgsOptimizerResults(converged=&lt;tf.Tensor: shape=(), dtype=bool, numpy=True&gt;, failed=&lt;tf.Tensor: shape=(), dtype=bool, numpy=False&gt;, num_iterations=&lt;tf.Tensor: shape=(), dtype=int32, numpy=139&gt;, num_objective_evaluations=&lt;tf.Tensor: shape=(), dtype=int32, numpy=419&gt;, position=&lt;tf.Tensor: shape=(1712997,), dtype=float32, numpy=
array([-3.8674193e-29, -1.1256556e-28, -2.5927603e-27, ...,
        0.0000000e+00,  0.0000000e+00,  0.0000000e+00], dtype=float32)&gt;, objective_value=&lt;tf.Tensor: shape=(), dtype=float32, numpy=0.6155101&gt;, objective_gradient=&lt;tf.Tensor: shape=(1712997,), dtype=float32, numpy=
array([1.9645911e-31, 4.9889720e-31, 9.8786898e-30, ..., 0.0000000e+00,
       0.0000000e+00, 0.0000000e+00], dtype=float32)&gt;, position_deltas=&lt;tf.Tensor: shape=(10, 1712997), dtype=float32, numpy=
array([[-3.5872955e-32, -1.9785808e-31, -6.3580033e-30, ...,
         0.0000000e+00,  0.0000000e+00,  0.0000000e+00],
       [-6.4805756e-32, -2.9292078e-31, -8.8182539e-30, ...,
         0.0000000e+00,  0.0000000e+00,  0.0000000e+00],
       [-1.4130340e-31, -5.7119358e-31, -1.6401924e-29, ...,
         0.0000000e+00,  0.0000000e+00,  0.0000000e+00],
       ...,
       [-5.4617808e-30, -1.6454125e-29, -3.9181032e-28, ...,
         0.0000000e+00,  0.0000000e+00,  0.0000000e+00],
       [-6.1342358e-30, -1.7497495e-29, -3.9646789e-28, ...,
         0.0000000e+00,  0.0000000e+00,  0.0000000e+00],
       [-7.4212054e-30, -2.0264394e-29, -4.3897991e-28, ...,
         0.0000000e+00,  0.0000000e+00,  0.0000000e+00]], dtype=float32)&gt;, gradient_deltas=&lt;tf.Tensor: shape=(10, 1712997), dtype=float32, numpy=
array([[3.5900332e-34, 1.1614237e-33, 2.9488757e-32, ..., 0.0000000e+00,
        0.0000000e+00, 0.0000000e+00],
       [5.3453962e-34, 1.6293450e-33, 3.9519332e-32, ..., 0.0000000e+00,
        0.0000000e+00, 0.0000000e+00],
       [1.0418452e-33, 3.0547259e-33, 7.1607366e-32, ..., 0.0000000e+00,
        0.0000000e+00, 0.0000000e+00],
       ...,
       [2.9082430e-32, 7.5094682e-32, 1.5245556e-30, ..., 0.0000000e+00,
        0.0000000e+00, 0.0000000e+00],
       [3.0533207e-32, 7.6540222e-32, 1.4901894e-30, ..., 0.0000000e+00,
        0.0000000e+00, 0.0000000e+00],
       [3.4899158e-32, 8.5288862e-32, 1.5965749e-30, ..., 0.0000000e+00,
        0.0000000e+00, 0.0000000e+00]], dtype=float32)&gt;)
Iterations before filter: 10
Applying low pass filter to wind field...
Done! Time = 137.1
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1662: UserWarning: linewidths is ignored by contourf
  result = super().contourf(*args, **kwargs)
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1614: UserWarning: The following kwargs were not used by contour: &#39;color&#39;
  result = super().contour(*args, **kwargs)
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1614: UserWarning: The following kwargs were not used by contour: &#39;color&#39;
  result = super().contour(*args, **kwargs)
/home/runner/work/PyDDA/PyDDA/pydda/retrieval/angles.py:24: RuntimeWarning: invalid value encountered in arccos
  elev = np.arccos((Re**2 + slantrsq - rh**2)/(2 * Re * slantr))
Calculating weights for radars 0 and 1
Calculating weights for models...
Starting solver
rmsVR = 6.7765408
Total points: 92100
The max of w_init is 0.0
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
      0|944064.3750|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000
The gradient of the cost functions is 61.585083
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     10|2796.5776|  28.0660|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.5678
The gradient of the cost functions is 6.018768
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     20|1805.0437|  30.2036|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.1664
The gradient of the cost functions is 8.139959
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     30|   4.7020|  29.4402|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.4764
The gradient of the cost functions is 0.32402736
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     40|   0.4515|  29.2483|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.4868
The gradient of the cost functions is 0.22223921
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     50|   0.8612|  28.3777|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.4620
The gradient of the cost functions is 2.1056516
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     60|   2.0815|  23.5633|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.3138
The gradient of the cost functions is 0.41992563
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     70|   2.5454|  19.2935|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.1570
The gradient of the cost functions is 0.25878623
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     80|   3.2603|  17.9574|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.1852
The gradient of the cost functions is 2.0410674
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     90|   2.6984|  15.2552|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.3531
The gradient of the cost functions is 0.49387243
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    100|   0.3357|  13.3571|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  11.9904
The gradient of the cost functions is 0.09958901
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    110|   0.3088|  13.2139|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  12.2758
The gradient of the cost functions is 0.3202762
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    120|   0.0671|  13.1229|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  12.2845
The gradient of the cost functions is 0.4248666
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    130|   0.5470|  11.6873|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  12.8064
The gradient of the cost functions is 0.39589947
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    140|   4.0218|   8.4661|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  15.8703
The gradient of the cost functions is 0.89387614
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    150|   0.0711|   8.3564|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  15.3597
The gradient of the cost functions is 0.07521078
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    160|   0.0072|   8.3180|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000|  15.4268
LBfgsOptimizerResults(converged=&lt;tf.Tensor: shape=(), dtype=bool, numpy=True&gt;, failed=&lt;tf.Tensor: shape=(), dtype=bool, numpy=False&gt;, num_iterations=&lt;tf.Tensor: shape=(), dtype=int32, numpy=54&gt;, num_objective_evaluations=&lt;tf.Tensor: shape=(), dtype=int32, numpy=163&gt;, position=&lt;tf.Tensor: shape=(1712997,), dtype=float32, numpy=array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)&gt;, objective_value=&lt;tf.Tensor: shape=(), dtype=float32, numpy=8.320535&gt;, objective_gradient=&lt;tf.Tensor: shape=(1712997,), dtype=float32, numpy=array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)&gt;, position_deltas=&lt;tf.Tensor: shape=(10, 1712997), dtype=float32, numpy=
array([[0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]], dtype=float32)&gt;, gradient_deltas=&lt;tf.Tensor: shape=(10, 1712997), dtype=float32, numpy=
array([[0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]], dtype=float32)&gt;)
Iterations before filter: 10
Applying low pass filter to wind field...
Done! Time = 53.8
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1662: UserWarning: linewidths is ignored by contourf
  result = super().contourf(*args, **kwargs)
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1614: UserWarning: The following kwargs were not used by contour: &#39;color&#39;
  result = super().contour(*args, **kwargs)
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1614: UserWarning: The following kwargs were not used by contour: &#39;color&#39;
  result = super().contour(*args, **kwargs)
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pydda</span>
<span class="kn">import</span> <span class="nn">pyart</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="n">berr_grid</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_grid</span><span class="p">(</span><span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">EXAMPLE_RADAR0</span><span class="p">)</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_grid</span><span class="p">(</span><span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">EXAMPLE_RADAR1</span><span class="p">)</span>

<span class="c1"># Load our radar data</span>
<span class="n">sounding</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_arm_sonde</span><span class="p">(</span>
    <span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">SOUNDING_PATH</span><span class="p">)</span>
<span class="n">u_init</span><span class="p">,</span> <span class="n">v_init</span><span class="p">,</span> <span class="n">w_init</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_constant_wind_field</span><span class="p">(</span>
    <span class="n">berr_grid</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

<span class="c1"># Let&#39;s make a plot on a map</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_horiz_xsection_streamlines_map</span><span class="p">(</span>
    <span class="p">[</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Let&#39;s see what happens when we use a zero initialization</span>
<span class="n">new_grids</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">get_dd_wind_field</span><span class="p">([</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span>
                                    <span class="n">u_init</span><span class="p">,</span> <span class="n">v_init</span><span class="p">,</span> <span class="n">w_init</span><span class="p">,</span>
                                    <span class="n">Co</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Cm</span><span class="o">=</span><span class="mf">128.0</span><span class="p">,</span> <span class="n">frz</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
                                    <span class="n">mask_outside_opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_horiz_xsection_streamlines_map</span><span class="p">(</span>
    <span class="n">new_grids</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Or, let&#39;s make the radar data more important!</span>
<span class="n">new_grids</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">get_dd_wind_field</span><span class="p">([</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span>
                                    <span class="n">u_init</span><span class="p">,</span> <span class="n">v_init</span><span class="p">,</span> <span class="n">w_init</span><span class="p">,</span>
                                    <span class="n">Co</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">Cm</span><span class="o">=</span><span class="mf">128.0</span><span class="p">,</span> <span class="n">frz</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
                                    <span class="n">mask_outside_opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_horiz_xsection_streamlines_map</span><span class="p">(</span>
    <span class="n">new_grids</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 3 minutes  18.989 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-source-auto-examples-plot-fun-with-constraints-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/564db4ff92b5949f5865201b6023e7a2/plot_fun_with_constraints.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_fun_with_constraints.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/69088b28623951c8bc5bf24f02f5316d/plot_fun_with_constraints.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_fun_with_constraints.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="oklahoma_example.html"
                          title="previous chapter">Example of a wind retrieval from KVNX and 2 XSAPRs in Oklahoma</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="plot_examples.html"
                          title="next chapter">Example on retrieving and plotting winds</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/source/auto_examples/plot_fun_with_constraints.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="plot_examples.html" title="Example on retrieving and plotting winds"
             >next</a> |</li>
        <li class="right" >
          <a href="oklahoma_example.html" title="Example of a wind retrieval from KVNX and 2 XSAPRs in Oklahoma"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">PyDDA 1.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >PyDDA Example Gallery</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Example on geographic plotting and constraint variation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, PyDDA Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>