

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Example on geographic plotting and constraint variation &#8212; PyDDA 1.5.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'source/auto_examples/plot_fun_with_constraints';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Developer Reference Manual" href="../../dev_reference/index.html" />
    <link rel="prev" title="Example on retrieving and plotting winds" href="plot_examples.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">PyDDA 1.5.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user_guide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contributors_guide/index.html">
                        Contributor’s Guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        PyDDA Example Gallery
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../dev_reference/index.html">
                        Developer Reference Manual
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__kbd-shortcut">Search</span>
    <span><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__kbd-shortcut">Search</span>
    <span><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user_guide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contributors_guide/index.html">
                        Contributor’s Guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        PyDDA Example Gallery
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../dev_reference/index.html">
                        Developer Reference Manual
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="hurricane_florence.html">Example on integrating radar and HRRR data</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot_sydney_tornado.html">Example of a wind retrieval in a tornado over Sydney</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot_examples.html">Example on retrieving and plotting winds</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Example on geographic plotting and constraint variation</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">PyDDA Example Gallery</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Example on geographic plotting and constraint variation</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-source-auto-examples-plot-fun-with-constraints-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="example-on-geographic-plotting-and-constraint-variation">
<span id="sphx-glr-source-auto-examples-plot-fun-with-constraints-py"></span><h1>Example on geographic plotting and constraint variation<a class="headerlink" href="#example-on-geographic-plotting-and-constraint-variation" title="Permalink to this heading">#</a></h1>
<p>In this example we show how to plot wind fields on a map and change
the default constraint coefficients using PyDDA.</p>
<p>This shows how important it is to have the proper intitial state and
constraints when you derive your wind fields. In the first figure,
the sounding was used as the initial state, but for the latter
two examples we use a zero initial state which provides for more
questionable winds at the edges of the Dual Doppler Lobes.</p>
<p>This shows that your initial state and background are key to
providing a physically realistic retrieval. Assuming a zero
background will likely result in false regions of convergence
and divergence that will generate artificial updrafts and downdrafts
at the edges of data coverage.</p>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_001.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_001.png" alt="PyDDA retreived winds @10.0 km south of origin." class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_002.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_002.png" alt="PyDDA retreived winds @10.0 km south of origin." class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_plot_fun_with_constraints_003.png" srcset="../../_images/sphx_glr_plot_fun_with_constraints_003.png" alt="PyDDA retreived winds @10.0 km south of origin." class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/pyart/io/cfradial.py:408: UserWarning: WARNING: valid_min not used since it
cannot be safely cast to variable data type
  data = self.ncvar[:]
/usr/share/miniconda3/envs/pydda-docs/lib/python3.10/site-packages/pyart/io/cfradial.py:408: UserWarning: WARNING: valid_max not used since it
cannot be safely cast to variable data type
  data = self.ncvar[:]
Interpolating sounding to radar grid
Interpolated U field:
tf.Tensor(
[  0.60573435   1.0229144    6.434673    11.977132    12.919597
   9.719978    14.212554    17.673002     9.373551     4.932108
   7.0470777    4.581866     3.8447456    1.9784147   -2.7835784
  -4.8090096   -8.388001    -8.310871    -6.199968    -8.8743305
  -7.5828705   -6.553336    -7.493186    -8.902025   -11.6616335
 -13.175965   -15.263804   -16.580751   -17.48236    -23.17236
 -20.712376   -18.823587   -16.356308   -25.138748   -29.280111
 -28.940443   -19.437548   -10.714591    -9.689518  ], shape=(39,), dtype=float32)
Interpolated V field:
tf.Tensor(
[-6.9235525  -6.326603   -6.434671   -6.9149985  -6.5828586  -3.927123
 -6.6274214  -8.241055   -9.051932   -3.2364333   0.8652741  -1.430016
  0.54577833 -1.4374017  -0.30149823  3.5418017   4.45998     5.19321
  5.667021    7.446448   10.062807   10.487528   11.109102   10.993081
  9.54446    11.055948    9.912431   11.183857    9.295537    2.4355142
 -0.723292   -1.9784379   1.1915643   5.803736    3.5951443  -2.0237138
  2.7317686   6.437976    2.7784247 ], shape=(39,), dtype=float32)
Grid levels:
[ 1000.  1500.  2000.  2500.  3000.  3500.  4000.  4500.  5000.  5500.
  6000.  6500.  7000.  7500.  8000.  8500.  9000.  9500. 10000. 10500.
 11000. 11500. 12000. 12500. 13000. 13500. 14000. 14500. 15000. 15500.
 16000. 16500. 17000. 17500. 18000. 18500. 19000. 19500. 20000.]
/home/runner/work/PyDDA/PyDDA/pydda/retrieval/angles.py:24: RuntimeWarning: invalid value encountered in arccos
  elev = np.arccos((Re**2 + slantrsq - rh**2) / (2 * Re * slantr))
Calculating weights for radars 0 and 1
Calculating weights for radars 1 and 0
Calculating weights for models...
Points from Radar 0: 40597
Points from Radar 1: 40597
Starting solver
rmsVR = 6.827304
Total points: 81194
The max of w_init is 0.0
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
      0|55964.2227|   0.0000|   0.0091|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000
The gradient of the cost functions is 28.291126
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     10| 433.0520|  10.8643|   0.0092|   3.0986|   0.0000|   0.0000|   0.0000|  14.6602
The gradient of the cost functions is 0.9322654
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     20|   7.5696|  11.9199|   0.0093|   3.1923|   0.0000|   0.0000|   0.0000|  14.3516
The gradient of the cost functions is 0.108117804
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     30|   4.4797|  11.2506|   0.0093|   3.2007|   0.0000|   0.0000|   0.0000|  14.2950
The gradient of the cost functions is 0.24360316
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     40|   0.2664|  10.8315|   0.0093|   3.2033|   0.0000|   0.0000|   0.0000|  14.3531
The gradient of the cost functions is 0.258406
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     50|   1.1081|   5.6735|   0.0093|   3.2813|   0.0000|   0.0000|   0.0000|  14.6250
The gradient of the cost functions is 0.061305936
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     60|   1.6095|   4.4080|   0.0093|   3.4170|   0.0000|   0.0000|   0.0000|  15.2762
The gradient of the cost functions is 0.12218659
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     70|   0.0535|   4.3390|   0.0093|   3.3971|   0.0000|   0.0000|   0.0000|  15.1830
The gradient of the cost functions is 0.112230875
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     80|   0.2807|   3.3781|   0.0093|   3.4398|   0.0000|   0.0000|   0.0000|  15.5190
The gradient of the cost functions is 0.051758513
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     90|   1.0581|   2.4080|   0.0093|   3.6301|   0.0000|   0.0000|   0.0000|  16.3007
The gradient of the cost functions is 0.10457411
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    100|   0.0483|   2.4010|   0.0093|   3.5898|   0.0000|   0.0000|   0.0000|  16.2115
The gradient of the cost functions is 0.049456704
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    110|   0.0814|   2.2034|   0.0093|   3.6100|   0.0000|   0.0000|   0.0000|  16.3215
The gradient of the cost functions is 0.049815755
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    120|   0.6869|   1.5476|   0.0093|   3.7707|   0.0000|   0.0000|   0.0000|  17.0703
The gradient of the cost functions is 0.10846455
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    130|   0.0268|   1.5556|   0.0093|   3.7333|   0.0000|   0.0000|   0.0000|  16.9280
The gradient of the cost functions is 0.027292885
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    140|   0.0306|   1.4981|   0.0093|   3.7383|   0.0000|   0.0000|   0.0000|  16.9617
The gradient of the cost functions is 0.042717613
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    150|   0.4080|   1.1065|   0.0093|   3.7895|   0.0000|   0.0000|   0.0000|  17.2925
The gradient of the cost functions is 0.10312765
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    160|   0.0236|   1.1075|   0.0093|   3.7809|   0.0000|   0.0000|   0.0000|  17.2615
The gradient of the cost functions is 0.01871165
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    170|   0.0207|   1.0828|   0.0093|   3.7814|   0.0000|   0.0000|   0.0000|  17.2774
The gradient of the cost functions is 0.031389352
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    180|   0.2004|   0.8937|   0.0093|   3.7681|   0.0000|   0.0000|   0.0000|  17.8297
The gradient of the cost functions is 0.114162244
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    190|   0.0271|   0.8746|   0.0093|   3.7660|   0.0000|   0.0000|   0.0000|  18.4548
The gradient of the cost functions is 0.014707348
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    200|   0.0090|   0.8632|   0.0093|   3.7637|   0.0000|   0.0000|   0.0000|  18.8838
The gradient of the cost functions is 0.01655056
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    210|   0.0497|   0.8166|   0.0093|   3.7508|   0.0000|   0.0000|   0.0000|  19.4606
The gradient of the cost functions is 0.1292962
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    220|   0.0408|   0.7467|   0.0093|   3.7189|   0.0000|   0.0000|   0.0000|  20.9271
The gradient of the cost functions is 0.014018058
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    230|   0.0077|   0.7449|   0.0093|   3.7053|   0.0000|   0.0000|   0.0000|  21.6975
Applying low pass filter to wind field...
Done! Time = 313.2
Interpolating sounding to radar grid
Interpolated U field:
tf.Tensor(
[  0.60573435   1.0229144    6.434673    11.977132    12.919597
   9.719978    14.212554    17.673002     9.373551     4.932108
   7.0470777    4.581866     3.8447456    1.9784147   -2.7835784
  -4.8090096   -8.388001    -8.310871    -6.199968    -8.8743305
  -7.5828705   -6.553336    -7.493186    -8.902025   -11.6616335
 -13.175965   -15.263804   -16.580751   -17.48236    -23.17236
 -20.712376   -18.823587   -16.356308   -25.138748   -29.280111
 -28.940443   -19.437548   -10.714591    -9.689518  ], shape=(39,), dtype=float32)
Interpolated V field:
tf.Tensor(
[-6.9235525  -6.326603   -6.434671   -6.9149985  -6.5828586  -3.927123
 -6.6274214  -8.241055   -9.051932   -3.2364333   0.8652741  -1.430016
  0.54577833 -1.4374017  -0.30149823  3.5418017   4.45998     5.19321
  5.667021    7.446448   10.062807   10.487528   11.109102   10.993081
  9.54446    11.055948    9.912431   11.183857    9.295537    2.4355142
 -0.723292   -1.9784379   1.1915643   5.803736    3.5951443  -2.0237138
  2.7317686   6.437976    2.7784247 ], shape=(39,), dtype=float32)
Grid levels:
[ 1000.  1500.  2000.  2500.  3000.  3500.  4000.  4500.  5000.  5500.
  6000.  6500.  7000.  7500.  8000.  8500.  9000.  9500. 10000. 10500.
 11000. 11500. 12000. 12500. 13000. 13500. 14000. 14500. 15000. 15500.
 16000. 16500. 17000. 17500. 18000. 18500. 19000. 19500. 20000.]
/home/runner/work/PyDDA/PyDDA/pydda/retrieval/angles.py:24: RuntimeWarning: invalid value encountered in arccos
  elev = np.arccos((Re**2 + slantrsq - rh**2) / (2 * Re * slantr))
Calculating weights for radars 0 and 1
Calculating weights for radars 1 and 0
Calculating weights for models...
Points from Radar 0: 40597
Points from Radar 1: 40597
Starting solver
rmsVR = 6.827304
Total points: 81194
The max of w_init is 0.0
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
      0|83859.8125|   0.0000|   0.0000|1274.4282|   0.0000|   0.0000|   0.0000|   0.0000
The gradient of the cost functions is 31.80247
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     10| 704.3429|  11.2237|   0.0003|1271.5498|   0.0000|   0.0000|   0.0000|  11.7762
The gradient of the cost functions is 1.1914004
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     20|  11.1114|  12.1835|   0.0003|1262.6161|   0.0000|   0.0000|   0.0000|  11.4604
The gradient of the cost functions is 0.33650497
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     30|  20.0218|  11.3132|   0.0003|1241.3234|   0.0000|   0.0000|   0.0000|  11.2256
The gradient of the cost functions is 2.3322194
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     40|  64.0980|   7.4645|   0.0004|1118.9155|   0.0000|   0.0000|   0.0000|  11.0131
The gradient of the cost functions is 3.1738365
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     50| 133.2814| 101.4496|   0.0048| 190.4297|   0.0000|   0.0000|   0.0000|  40.1330
The gradient of the cost functions is 0.575966
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     60| 116.2430| 163.7324|   0.0076|  59.7310|   0.0000|   0.0000|   0.0000|  49.3056
The gradient of the cost functions is 1.4573013
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     70|   9.4493| 152.7098|   0.0077|  54.8049|   0.0000|   0.0000|   0.0000|  48.0482
The gradient of the cost functions is 1.1319462
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     80|  23.7043|  66.5472|   0.0086|  14.8136|   0.0000|   0.0000|   0.0000|  36.1306
The gradient of the cost functions is 1.6997486
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     90|   5.6146|  27.0551|   0.0091|   7.3213|   0.0000|   0.0000|   0.0000|  24.3880
The gradient of the cost functions is 0.19911101
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    100|   0.4343|  24.8763|   0.0090|   7.3544|   0.0000|   0.0000|   0.0000|  23.9773
The gradient of the cost functions is 0.20724337
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    110|   9.3379|  13.8839|   0.0086|   8.3275|   0.0000|   0.0000|   0.0000|  22.6053
The gradient of the cost functions is 1.2827213
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    120|   2.0562|   7.7675|   0.0084|   9.2695|   0.0000|   0.0000|   0.0000|  20.3768
The gradient of the cost functions is 0.10957267
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    130|   0.2903|   6.4048|   0.0083|   9.6173|   0.0000|   0.0000|   0.0000|  19.3785
The gradient of the cost functions is 0.08271687
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    140|   1.2587|   5.3632|   0.0083|   9.1258|   0.0000|   0.0000|   0.0000|  18.9749
The gradient of the cost functions is 0.5516492
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    150|   1.6371|   3.2382|   0.0084|   7.6998|   0.0000|   0.0000|   0.0000|  19.2732
The gradient of the cost functions is 0.1383003
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    160|   0.4293|   2.4377|   0.0086|   6.1152|   0.0000|   0.0000|   0.0000|  20.2584
The gradient of the cost functions is 0.038444586
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    170|   0.5616|   2.4281|   0.0087|   5.8257|   0.0000|   0.0000|   0.0000|  20.4413
The gradient of the cost functions is 0.18903205
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    180|   0.4030|   2.1688|   0.0087|   5.5776|   0.0000|   0.0000|   0.0000|  20.5341
The gradient of the cost functions is 0.108853504
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    190|   0.2012|   1.7315|   0.0089|   4.7043|   0.0000|   0.0000|   0.0000|  20.9312
The gradient of the cost functions is 0.025811834
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    200|   0.2664|   1.7224|   0.0089|   4.5391|   0.0000|   0.0000|   0.0000|  20.9959
Applying low pass filter to wind field...
Done! Time = 267.0
Interpolating sounding to radar grid
Interpolated U field:
tf.Tensor(
[  0.60573435   1.0229144    6.434673    11.977132    12.919597
   9.719978    14.212554    17.673002     9.373551     4.932108
   7.0470777    4.581866     3.8447456    1.9784147   -2.7835784
  -4.8090096   -8.388001    -8.310871    -6.199968    -8.8743305
  -7.5828705   -6.553336    -7.493186    -8.902025   -11.6616335
 -13.175965   -15.263804   -16.580751   -17.48236    -23.17236
 -20.712376   -18.823587   -16.356308   -25.138748   -29.280111
 -28.940443   -19.437548   -10.714591    -9.689518  ], shape=(39,), dtype=float32)
Interpolated V field:
tf.Tensor(
[-6.9235525  -6.326603   -6.434671   -6.9149985  -6.5828586  -3.927123
 -6.6274214  -8.241055   -9.051932   -3.2364333   0.8652741  -1.430016
  0.54577833 -1.4374017  -0.30149823  3.5418017   4.45998     5.19321
  5.667021    7.446448   10.062807   10.487528   11.109102   10.993081
  9.54446    11.055948    9.912431   11.183857    9.295537    2.4355142
 -0.723292   -1.9784379   1.1915643   5.803736    3.5951443  -2.0237138
  2.7317686   6.437976    2.7784247 ], shape=(39,), dtype=float32)
Grid levels:
[ 1000.  1500.  2000.  2500.  3000.  3500.  4000.  4500.  5000.  5500.
  6000.  6500.  7000.  7500.  8000.  8500.  9000.  9500. 10000. 10500.
 11000. 11500. 12000. 12500. 13000. 13500. 14000. 14500. 15000. 15500.
 16000. 16500. 17000. 17500. 18000. 18500. 19000. 19500. 20000.]
/home/runner/work/PyDDA/PyDDA/pydda/retrieval/angles.py:24: RuntimeWarning: invalid value encountered in arccos
  elev = np.arccos((Re**2 + slantrsq - rh**2) / (2 * Re * slantr))
Calculating weights for radars 0 and 1
Calculating weights for radars 1 and 0
Calculating weights for models...
Points from Radar 0: 40597
Points from Radar 1: 40597
Starting solver
rmsVR = 6.827304
Total points: 81194
The max of w_init is 0.0
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
      0|559642.2500|   0.0000|   0.0091|   0.0000|   0.0000|   0.0000|   0.0000|   0.0000
The gradient of the cost functions is 43.085587
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     10|1749.9775|  11.5556|   0.0093|   3.1306|   0.0000|   0.0000|   0.0000|  14.5070
The gradient of the cost functions is 4.6896577
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     20|1137.2308|  12.8649|   0.0093|   3.2926|   0.0000|   0.0000|   0.0000|  14.2361
The gradient of the cost functions is 6.3044558
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     30|   2.9881|  12.4682|   0.0093|   3.2075|   0.0000|   0.0000|   0.0000|  14.5336
The gradient of the cost functions is 0.23147261
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     40|   0.2791|  12.4197|   0.0093|   3.2057|   0.0000|   0.0000|   0.0000|  14.5405
The gradient of the cost functions is 0.102958694
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     50|   0.3197|  12.2683|   0.0093|   3.2062|   0.0000|   0.0000|   0.0000|  14.5278
The gradient of the cost functions is 0.8344458
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     60|   0.3998|  11.4562|   0.0093|   3.2103|   0.0000|   0.0000|   0.0000|  14.4570
The gradient of the cost functions is 0.22998074
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     70|   0.5988|  10.1893|   0.0093|   3.2253|   0.0000|   0.0000|   0.0000|  14.3264
The gradient of the cost functions is 0.13649559
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     80|   0.9579|   9.6588|   0.0093|   3.2293|   0.0000|   0.0000|   0.0000|  14.2695
The gradient of the cost functions is 1.1096873
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
     90|   1.4194|   7.8094|   0.0093|   3.2453|   0.0000|   0.0000|   0.0000|  14.1845
The gradient of the cost functions is 0.5622433
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    100|   0.4597|   4.6916|   0.0093|   3.3586|   0.0000|   0.0000|   0.0000|  14.9792
The gradient of the cost functions is 0.09190905
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    110|   0.3639|   4.5901|   0.0093|   3.3930|   0.0000|   0.0000|   0.0000|  15.1395
The gradient of the cost functions is 0.15870957
Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w
    120|   0.0040|   4.5883|   0.0093|   3.3888|   0.0000|   0.0000|   0.0000|  15.1114
Applying low pass filter to wind field...
Done! Time = 160.7
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pydda</span>
<span class="kn">import</span> <span class="nn">pyart</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="n">berr_grid</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_grid</span><span class="p">(</span><span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">EXAMPLE_RADAR0</span><span class="p">)</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_grid</span><span class="p">(</span><span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">EXAMPLE_RADAR1</span><span class="p">)</span>

<span class="c1"># Load our radar data</span>
<span class="n">sounding</span> <span class="o">=</span> <span class="n">pyart</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_arm_sonde</span><span class="p">(</span><span class="n">pydda</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">SOUNDING_PATH</span><span class="p">)</span>
<span class="n">berr_grid</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_constant_wind_field</span><span class="p">(</span><span class="n">berr_grid</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

<span class="c1"># Let&#39;s provide an initial state from the sounding</span>
<span class="n">u_back</span> <span class="o">=</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">u_wind</span>
<span class="n">v_back</span> <span class="o">=</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v_wind</span>
<span class="n">z_back</span> <span class="o">=</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">height</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_wind_field_from_profile</span><span class="p">(</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">new_grids</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">get_dd_wind_field</span><span class="p">(</span>
    <span class="p">[</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span>
    <span class="n">u_back</span><span class="o">=</span><span class="n">u_back</span><span class="p">,</span>
    <span class="n">v_back</span><span class="o">=</span><span class="n">v_back</span><span class="p">,</span>
    <span class="n">z_back</span><span class="o">=</span><span class="n">z_back</span><span class="p">,</span>
    <span class="n">Co</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">Cm</span><span class="o">=</span><span class="mf">64.0</span><span class="p">,</span>
    <span class="n">frz</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
    <span class="n">Cb</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
    <span class="n">Cx</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cy</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cz</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">mask_outside_opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">wind_tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_xz_xsection_streamlines</span><span class="p">(</span>
    <span class="n">new_grids</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Let&#39;s see what happens when we use a zero initialization</span>
<span class="c1"># This causes there to be convergence in the cone of silence</span>
<span class="c1"># This is an artifact that we want to avoid!</span>
<span class="c1"># Prescribing winds inside the background through either a constraint</span>
<span class="c1"># Or through the initial state will help mitigate this issue.</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_constant_wind_field</span><span class="p">(</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="n">new_grids</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">get_dd_wind_field</span><span class="p">(</span>
    <span class="p">[</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span>
    <span class="n">u_back</span><span class="o">=</span><span class="n">u_back</span><span class="p">,</span>
    <span class="n">v_back</span><span class="o">=</span><span class="n">v_back</span><span class="p">,</span>
    <span class="n">z_back</span><span class="o">=</span><span class="n">z_back</span><span class="p">,</span>
    <span class="n">Co</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">Cm</span><span class="o">=</span><span class="mf">64.0</span><span class="p">,</span>
    <span class="n">frz</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
    <span class="n">Cb</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
    <span class="n">Cx</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cy</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cz</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">mask_outside_opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">wind_tol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_xz_xsection_streamlines</span><span class="p">(</span>
    <span class="n">new_grids</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Or, let&#39;s make the radar data more important!</span>
<span class="n">cpol_grid</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">make_wind_field_from_profile</span><span class="p">(</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">sounding</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">new_grids</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pydda</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">get_dd_wind_field</span><span class="p">(</span>
    <span class="p">[</span><span class="n">cpol_grid</span><span class="p">,</span> <span class="n">berr_grid</span><span class="p">],</span>
    <span class="n">Co</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">Cm</span><span class="o">=</span><span class="mf">64.0</span><span class="p">,</span>
    <span class="n">frz</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
    <span class="n">u_back</span><span class="o">=</span><span class="n">u_back</span><span class="p">,</span>
    <span class="n">v_back</span><span class="o">=</span><span class="n">v_back</span><span class="p">,</span>
    <span class="n">z_back</span><span class="o">=</span><span class="n">z_back</span><span class="p">,</span>
    <span class="n">Cb</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
    <span class="n">Cx</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cy</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">Cz</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
    <span class="n">mask_outside_opt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">wind_tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">pydda</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">plot_xz_xsection_streamlines</span><span class="p">(</span>
    <span class="n">new_grids</span><span class="p">,</span> <span class="n">bg_grid_no</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">w_vel_contours</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (12 minutes 24.447 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-source-auto-examples-plot-fun-with-constraints-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/564db4ff92b5949f5865201b6023e7a2/plot_fun_with_constraints.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_fun_with_constraints.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/69088b28623951c8bc5bf24f02f5316d/plot_fun_with_constraints.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_fun_with_constraints.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="plot_examples.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Example on retrieving and plotting winds</p>
      </div>
    </a>
    <a class="right-next"
       href="../../dev_reference/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Developer Reference Manual</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/source/auto_examples/plot_fun_with_constraints.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, PyDDA Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>